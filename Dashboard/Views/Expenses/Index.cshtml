@{
    ViewBag.Title = "Index";
}
<link href="https://fonts.googleapis.com/earlyaccess/droidarabickufi.css" rel="stylesheet" />

<style>
    .select2-container {
        font-family: 'Droid Arabic Kufi', serif;
    }
</style>

<div class="row">
    <div class="form-group col-md-12 d-flex justify-content-center" dir="rtl">
        <div class="col-md-2 bg-white p-2">
            <select id="month" name="month" class="select2-container selectpicker form-control">
                <option value="0"> اخـتـر الـشـهـر </option>
            </select>
        </div>
    </div>
</div>

<div class="mt-4" style="margin-bottom:10px;">
    <div class="col-lg-12 mb-lg-0 mb-4">
        <div class="card z-index-2 h-100">
            <div class="card-body p-3">

                <center>
                    <div class="col-xl-6">
                        <div class="card mb-4">
                            <div class="card-header">
                                <i class="fas fa-chart-area me-1 text-right"></i>
                                <span style="font-family: 'Droid Arabic Kufi', serif;font-weight:bold;">

                                    مصروفات ومبيعات شهر
                                    <span id="monthSpan" style="font-weight:bolder;font-size:larger;color:red;">
                                       
                                    </span>
                                </span>
                            </div>
                            <div id="chart_container" class="chart chart-pie chartreport pieChart"><canvas id="pie_chart"></canvas></div>
                        </div>
                    </div>
                </center>

            </div>
        </div>
    </div>
</div>

<div class="row" id="cards" style="font-family: 'Droid Arabic Kufi', serif;font-weight:bold;">
    <div class="col-xl-4 col-sm-6 mb-xl-0 mb-4">

    </div>
</div>

@section Scripts{
    <script>
        $(document).ready(function () {
            $("#month").select2({ theme: 'filled', dir: "ltr" });

            $(function () {
                $.ajax({
                    url: '@Url.Action("GetMonthes", "Expenses")',
                    type: 'GET',
                    dataType: 'json',
                    success: function (data) {
                        var str = "<option value='0'> اخـتـر الـشـهـر </option>";
                        $.each(data, function (index, val) {
                            str += "<option value='" + val.ID + "'>" + val.Name + "</option>"
                        });
                        $("#month").html(str);
                     },
                    error: function (err) {
                        console.log(err);
                    }
                });
            });

            DrawChart(null);

            $("#CompId").on('change', function () {
                var _dataBase = $("#CompId").val();
                DrawChart(_dataBase);
            });

            $("#month").on('change', function () {
                var val = Number($("#month").val());
                var _database = $("#CompId").val();
                if (val == 0)
                    $("#monthSpan").html("يناير");
                else
                    $("#monthSpan").html($("#month option:selected").text());
                DrawChart(_database);
                $("#month").attr('disabled', true);
                setInterval(function () {
                    $("#month").removeAttr("disabled");
                }, 3000);
            });
        });

        function DrawChart(database) {
            $("#pie_chart").remove();
            $('.pieChart').append("<canvas id='pie_chart'></canvas>");

            $("#cards").children().remove();

            var month = Number($("#month").val());
            $.ajax({
                url: '@Url.Action("PieChart", "Expenses")',
                type: 'GET',
                dataType: 'json',
                data: { dataBase: database, month: month },
                success: function (data) {
                    var Descriptions = [], Values = [];
                    $.each(data, function (index, val) {
                        Descriptions.push(val.s_desc);
                        Values.push(val.CurrentMonth);

                        if (val.CurrentMonth > val.PreviousMonth && val.PreviousMonth != null) {
                                $("#cards").append(
                                    '<div class="col-xl-4 col-sm-6 mb-xl-0 mb-4">'
                                    + '<div class="card" style="margin-bottom:10px;">'
                                    + '<div class="card-body p-3">'
                                    + '<div class="row">'
                                    + '<div class="col-8">'
                                    + '<div class="numbers" id="copareDiv">'
                                    + '<p class="text-lg mb-0 text-uppercase font-weight-bold" style="display: inline-block; font-family: " Droid Arabic Kufi", serif;">' + val.s_desc + '<i class="fa fa-arrow-up text-sm" style="color:red;"></i></p>'
                                    + '<h6 class="font-weight-bolder" style="letter-spacing:3px;">' + Intl.NumberFormat().format(val.CurrentMonth) + '</h6>'
                                    + '</div>'
                                    + '</div>'
                                    + '<div class="col-4 text-end">'
                                    + '<div class="icon icon-shape shadow-primary text-center rounded-circle" style="background-color: #28c24c;">'
                                    + '<i class="fas fa-hand-holding-usd text-lg opacity-10" aria-hidden="true"></i>'
                                    + '</div>'
                                    + '</div>'
                                    + '</div>'
                                    + '</div>'
                                    + '</div>'
                                    + '</div>'
                                );
                            } else if (val.CurrentMonth < val.PreviousMonth) {
                                $("#cards").append(
                                    '<div class="col-xl-4 col-sm-6 mb-xl-0 mb-4">'
                                    + '<div class="card" style="margin-bottom:10px;">'
                                    + '<div class="card-body p-3">'
                                    + '<div class="row">'
                                    + '<div class="col-8">'
                                    + '<div class="numbers" id="copareDiv">'
                                    + '<p class="text-lg mb-0 text-uppercase font-weight-bold" style="display: inline-block; font-family: " Droid Arabic Kufi", serif;">' + val.s_desc + '<i class="fa fa-arrow-down text-sm" style="color:green;"></i></p>'
                                    + '<h6 class="font-weight-bolder" style="letter-spacing:3px;">' + Intl.NumberFormat().format(val.CurrentMonth) + '</h6>'
                                    + '</div>'
                                    + '</div>'
                                    + '<div class="col-4 text-end">'
                                    + '<div class="icon icon-shape shadow-primary text-center rounded-circle" style="background-color: #28c24c;">'
                                    + '<i class="fas fa-hand-holding-usd text-lg opacity-10" aria-hidden="true"></i>'
                                    + '</div>'
                                    + '</div>'
                                    + '</div>'
                                    + '</div>'
                                    + '</div>'
                                    + '</div>'
                                );
                            } else if (val.CurrentMonth != null && val.PreviousMonth == null) {
                                $("#cards").append(
                                    '<div class="col-xl-4 col-sm-6 mb-xl-0 mb-4">'
                                    + '<div class="card" style="margin-bottom:10px;">'
                                    + '<div class="card-body p-3">'
                                    + '<div class="row">'
                                    + '<div class="col-8">'
                                    + '<div class="numbers" id="copareDiv">'
                                    + '<p class="text-lg mb-0 text-uppercase font-weight-bold" style="font-family: " Droid Arabic Kufi", serif;">' + val.s_desc + '<i class="fas fa-exchange-alt text-sm" style="color: #BFBEBE "></i> </p>'
                                    + '<h6 class="font-weight-bolder" style="letter-spacing:3px;">' + Intl.NumberFormat().format(val.CurrentMonth) + '</h6>'
                                    + '</div>'
                                    + '</div>'
                                    + '<div class="col-4 text-end">'
                                    + '<div class="icon icon-shape shadow-primary text-center rounded-circle" style="background-color: #28c24c;">'
                                    + '<i class="fas fa-hand-holding-usd text-lg opacity-10" aria-hidden="true"></i>'
                                    + '</div>'
                                    + '</div>'
                                    + '</div>'
                                    + '</div>'
                                    + '</div>'
                                    + '</div>'
                            );
                        } else if (val.CurrentMonth == null && val.PreviousMonth == null) {
                                $("#cards").append(
                                    '<div class="col-xl-4 col-sm-6 mb-xl-0 mb-4">'
                                    + '<div class="card" style="margin-bottom:10px;">'
                                    + '<div class="card-body p-3">'
                                    + '<div class="row">'
                                    + '<div class="col-8">'
                                    + '<div class="numbers" id="copareDiv">'
                                    + '<p class="text-lg mb-0 text-uppercase font-weight-bold" style="font-family: " Droid Arabic Kufi", serif;">' + val.s_desc + '<i class="fas fa-exchange-alt text-sm" style="color: #BFBEBE "></i> </p>'
                                    + '<h6 class="font-weight-bolder" style="letter-spacing:3px;">' + Intl.NumberFormat().format(val.CurrentMonth) + '</h6>'
                                    + '</div>'
                                    + '</div>'
                                    + '<div class="col-4 text-end">'
                                    + '<div class="icon icon-shape shadow-primary text-center rounded-circle" style="background-color: #28c24c;">'
                                    + '<i class="fas fa-hand-holding-usd text-lg opacity-10" aria-hidden="true"></i>'
                                    + '</div>'
                                    + '</div>'
                                    + '</div>'
                                    + '</div>'
                                    + '</div>'
                                    + '</div>'
                                );
                            } else {
                                $("#cards").append(
                                    '<div class="col-xl-4 col-sm-6 mb-xl-0 mb-4">'
                                    + '<div class="card" style="margin-bottom:10px;">'
                                    + '<div class="card-body p-3">'
                                    + '<div class="row">'
                                    + '<div class="col-8">'
                                    + '<div class="numbers" id="copareDiv">'
                                    + '<p class="text-lg mb-0 text-uppercase font-weight-bold" style="font-family: " Droid Arabic Kufi", serif;">' + val.s_desc + '<i class="fas fa-exchange-alt text-sm" style="color: #BFBEBE "></i> </p>'
                                    + '<h6 class="font-weight-bolder" style="letter-spacing:3px;">' + Intl.NumberFormat().format(val.CurrentMonth) + '</h6>'
                                    + '</div>'
                                    + '</div>'
                                    + '<div class="col-4 text-end">'
                                    + '<div class="icon icon-shape shadow-primary text-center rounded-circle" style="background-color: #28c24c;">'
                                    + '<i class="fas fa-hand-holding-usd text-lg opacity-10" aria-hidden="true"></i>'
                                    + '</div>'
                                    + '</div>'
                                    + '</div>'
                                    + '</div>'
                                    + '</div>'
                                    + '</div>'
                                );
                            }
                    });

                    new Chart('pie_chart', {
                        type: 'pie',
                        data: {
                            labels: Descriptions,
                            datasets: [{
                                label: 'Monthly Expenses',
                                data: Values,
                                backgroundColor: ["#7CDDDD", "#007ED6", "#FF0000", "#FF7300", "#FFEC00", "#2900A5", "#52D726", "#58508D", "#BC5090"],
                                borderColor: ["#7CDDDD", "#007ED6", "#FF0000", "#FF7300", "#FFEC00", "#2900A5", "#52D726", "#58508D", "#BC5090"],
                            }],
                        },
                    });
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    </script>
}